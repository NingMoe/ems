<%@ Page Language="C#" MasterPageFile="MasterPage.Master" AutoEventWireup="true" CodeBehind="User.aspx.cs" Inherits="XueFuShop.Admin.User"%>
<%@ Import Namespace="XueFu.EntLib" %>
<%@ Import Namespace="XueFuShop.BLL" %>
<asp:Content ID="MasterContent" ContentPlaceHolderID="ContentPlaceHolder" runat="server"><script language="javascript" src="/Admin/js/calendar.js" type="text/javascript"></script>
<link rel="stylesheet" href="Style/jquery.bigautocomplete.css" type="text/css" />
<script type="text/javascript" src="http://cdn.bootcss.com/jquery/1.12.1/jquery.min.js"></script>
<script type="text/javascript" src="Js/jquery.bigautocomplete.js"></script><div class="position"><img src="/Admin/Style/Images/PositionIcon.png"  alt=""/>用户列表</div>	<ul class="search">    <li>        公司：<input type="text" name="CompanyName" id="CompanyName" value="" size="55"  Class="input companyname"  runat="server" />        <input type="hidden" name="CompanyID" id="CompanyID" value="<%=companyID.ToString() %>" />        用户名：<XueFu:TextBox ID="UserName" CssClass="input" runat="server"  />        姓名：<XueFu:TextBox ID="RealName" CssClass="input" runat="server"/>        手机：<XueFu:TextBox ID="Mobile" CssClass="input" runat="server" />        Email：<XueFu:TextBox ID="Email" CssClass="input" runat="server"  />        <%--性别：<asp:DropDownList ID="Sex" runat="server"></asp:DropDownList>--%>        注册时间：<XueFu:TextBox CssClass="input" ID="StartRegisterDate" runat="server" RequiredFieldType="日期时间"  onfocus="cdr.show(this);"/> -- <XueFu:TextBox CssClass="input" ID="EndRegisterDate" runat="server" RequiredFieldType="日期时间"  onfocus="cdr.show(this);"/>        <asp:Button CssClass="button" ID="SearchButton" Text=" 搜 索 " runat="server"  OnClick="SearchButton_Click" />    </li></ul><div  class="listBlock">    <ul>               <li <%if(status== int.MinValue){%>class="listOn"<%} %> onclick="window.location='User.aspx?Action=search&<%=url%>'">所有用户</li>        <li <%if(status==0){%>class="listOn"<%} %> onclick="window.location='User.aspx?Action=search&Status=0&<%=url%>'">删除用户</li>        <li <%if(status==1){%>class="listOn"<%} %> onclick="window.location='User.aspx?Action=search&Status=1&<%=url%>'">未激活用户</li>         <li <%if(status==2){%>class="listOn"<%} %> onclick="window.location='User.aspx?Action=search&Status=2&<%=url%>'">正常用户</li>               <li <%if(status==3){%>class="listOn"<%} %> onclick="window.location='User.aspx?Action=search&Status=3&<%=url%>'">冻结用户</li>        <li <%if(status==4){%>class="listOn"<%} %> onclick="window.location='User.aspx?Action=search&Status=4&<%=url%>'">不考核用户</li>        <li <%if(status==5){%>class="listOn"<%} %> onclick="window.location='User.aspx?Action=search&Status=5&<%=url%>'">其他用户</li>        <%if (!String.IsNullOrEmpty(RequestHelper.GetQueryString<string>("Action")))
          {%><li style="border:0;"><asp:Button CssClass="button" ID="UserOutXls" Text=" 导 出 " runat="server"  OnClick="UserOutXls_Click" /></li><%} %>    </ul>    	</div><table class="listTable" cellpadding="0">    <tr class="listTableHead">	    <td style="width:5%"><input type="checkbox" name="All" onclick="selectAll(this)" /></td>	    <td style="width:10%; text-align:left;text-indent:8px;">用户ID</td>	    <td style="width:8%;">姓名</td>	    <td style="width:10%">公司简称</td>	    <td style="width:8%">职位</td>	    <td style="width:8%">员工权限</td>	     <td style="width:9%">手机号码</td>	    <td style="width:12%">Email</td>	    <td style="width:10%">最近登录时间</td>	    <td style="width:5%">状态</td>	    <td style="width:15%">管理</td>    </tr><asp:Repeater ID="RecordList" runat="server">	<ItemTemplate>	             	<tr class="listTableMain" onmousemove="changeColor(this,'#FFFDD7')" onmouseout="changeColor(this,'#FFF')">			    <td><input type="checkbox" name="SelectID" value="<%# Eval("ID") %>" title="<%# Eval("ID") %>" /></td>			    <td style="width:10%; text-align:left;text-indent:8px;"><%# Eval("UserName") %></td>			    <td><%# Eval("RealName") %></td>			    <td><%# ReadCompany(int.Parse(Eval("CompanyID").ToString())).CompanySimpleName %></td>			    <td><%# string.IsNullOrEmpty(Eval("PostName").ToString())?PostBLL.ReadPost(int.Parse(Eval("WorkingPostID").ToString())).PostName:Eval("PostName") %></td>			    <td><%# AdminGroupBLL.ReadAdminGroupCache(Convert.ToInt32(Eval("GroupID"))).Name%></td>	            <td><%# Eval("Mobile") %></td>			    <td><%# Eval("Email") %></td>	            <td><%#Eval("LastLoginDate")%></td>	            <td><%#EnumHelper.ReadEnumChineseName<UserState>(Convert.ToInt32(Eval("Status")))%></td>			    <td>			        <a href="AuthorizeLogin.aspx?UserID=<%#Eval("ID")%>" target="_blank" title="授权登陆"><i class="iconfont icon-shouquan"></i></a> 		    			        <a href="javascript:popPageOnly('UserPasswordAdd.aspx?ID=<%#Eval("ID")%>',600,250,'修改密码','UserPasswordAdd<%# Eval("ID") %>')" alt="修改密码" title="修改密码"><i class="iconfont icon-xiugaimima"></i></a> 			        <a href="javascript:pop('UserAdd.aspx?ID=<%#Eval("ID")%>',800,450,'用户修改','UserAdd<%# Eval("ID") %>')" alt="修改" title="修改"><i class="iconfont icon-bianji"></i></a> 			        <%--<a href="javascript:popPageOnly('UserAddress.aspx?UserID=<%#Eval("ID")%>',800,600,'收货地址','UserAddress<%# Eval("ID") %>')"><img src="Style/Images/list.gif" alt="收货地址" title="收货地址" /></a> 			        <a href="javascript:popPageOnly('UserAccountRecord.aspx?UserID=<%#Eval("ID")%>',800,600,'帐户明细','UserAccountRecord<%# Eval("ID") %>')"><img src="Style/Images/passport.gif" alt="帐户明细" title="帐户明细" /></a> --%>			        <a href="javascript:deleteUser(<%#Eval("ID") %>)" alt="删除" title="删除"><i class="iconfont icon-iconfontshanchu"></i></a>			    </td>			    <td style="width:5%"></td> 	        		    </tr>        </ItemTemplate></asp:Repeater></table><div class="listPage"><XueFu:CommonPager ID="MyPager" runat="server" /></div><div class="action">        <input type="button"  value=" 添 加 " class="button" onclick="pop('UserAdd.aspx',800,600,'用户添加','UserAdd')"/>&nbsp;        <%if(status==(int)UserState.Del){ %><asp:Button CssClass="button" ID="RecoveryButton" Text=" 恢 复 " OnClientClick="return checkSelect()" runat="server"  OnClick="RecoveryButton_Click"/>&nbsp;<%} %>        <%if (status == (int)UserState.NoCheck || status == (int)UserState.Free || status == (int)UserState.Other)
          { %><asp:Button CssClass="button" ID="ActiveButton" Text=" 激 活 " OnClientClick="return checkSelect()" runat="server"  OnClick="ActiveButton_Click"/>&nbsp;<%} %>        <%if (status == (int)UserState.Normal || status == (int)UserState.Free || status == (int)UserState.Other)
          { %>        <asp:Button CssClass="button" ID="UnActiveButton" Text="未验证" OnClientClick="return checkSelect()" runat="server"  OnClick="UnActiveButton_Click"/>&nbsp;        <asp:Button CssClass="button" ID="FreezeButton" Text=" 冻 结 " OnClientClick="return checkSelect()" runat="server"  OnClick="FreezeButton_Click"/>&nbsp;        <%if(status != (int)UserState.Free){ %><asp:Button CssClass="button" ID="FreeButton" Text="不考核" OnClientClick="return checkSelect()" runat="server"  OnClick="FreeButton_Click"/>&nbsp;<%} %>        <%if(status != (int)UserState.Other){ %><asp:Button CssClass="button" ID="OtherButton" Text=" 其 他 " OnClientClick="return checkSelect()" runat="server"  OnClick="OtherButton_Click"/>&nbsp;<%} %>        <%} %>        <%if(status == 3){ %><asp:Button CssClass="button" ID="UnFreezeButton" Text="解除冻结" OnClientClick="return checkSelect()" runat="server"  OnClick="UnFreezeButton_Click"/>&nbsp;<%} %>        <%if(status != (int)UserState.Del){ %><asp:Button CssClass="button" ID="DeleteButton" Text=" 删 除 " OnClientClick="return checkSelect()" runat="server"  OnClick="DeleteButton_Click"/>&nbsp;<%} %>        <%if(status>=0){ %><input type="checkbox" name="All" onclick="selectAll(this)" />全选/取消<%} %></div>
<script type="text/javascript">
$(function(){
	$("#ctl00_ContentPlaceHolder_CompanyName").bigAutocomplete({
	    width:"304px",
		url:"Ajax.aspx?Action=SearchCompanyName",
		callback:function(data){
		    var result=data.result;
    		$("#CompanyID").val(result.Id);
		}
	});
})
</script><script language="javascript" type="text/javascript">//删除用户
function deleteUser(userID){    if(window.confirm("确定要删除该用户？")){        var url="Ajax.aspx?Action=DeleteUser&UserID="+userID;        Ajax.requestURL(url,dealDeleteUser);    }}function dealDeleteUser(data){    if(data=="ok"){        reloadPage();    }    else{        alertMessage("该用户存在账户记录，不能删除。");    }}</script></asp:Content>